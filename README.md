# TelecomBase

Десктопное приложение (Qt/C++) + Go API + PostgreSQL для ведения сведений о телекоммуникационном оборудовании.

## Быстрый старт (backend + DB)

Требования:

- Linux
- Docker + Docker Compose

1) Скопируйте переменные окружения:

`cp .env.example .env`

2) Запустите сервисы:

`docker compose up --build`

Или одной командой через скрипт (создаст `.env`, поднимет сервисы и применит миграции):

`./run.sh`

Полный сброс БД перед запуском:

`./run.sh --reset-db`

3) Проверка доступности API:

`curl -s http://localhost:8080/health`

Ожидаемый ответ: `{"status":"ok"}`

PostgreSQL доступен на хосте по порту `5433`.

Важно: по умолчанию БД запускается **пустой** (без демо-справочников). Если нужно засеять демо-данные, запустите API с переменной `SEED_DEMO=true`.

## SQL-запросы (без SQL в Go-коде)

SQL-запросы для API хранятся в `.sql` файлах в каталоге [server/db/queries/](server/db/queries/). Go-сервер загружает их при старте и обращается к ним по имени (`-- name: ...`).

Если нужно, можно переопределить путь к каталогу с запросами переменной окружения `TELECOMBASE_SQL_DIR`.

Для будущей генерации типобезопасного слоя через `sqlc` добавлен конфиг [server/sqlc.yaml](server/sqlc.yaml) (команда: `sqlc generate -f server/sqlc.yaml`).

## Сброс БД (полностью очистить)

`docker compose down -v`

## Сборка Qt клиента (Linux)

Зависимости: Qt6 (Widgets, Network), CMake, компилятор C++20.

Команды:

`cmake -S . -B build`

`cmake --build build -j`

Запуск клиента:

`./build/client/TelecomBaseClient`

## Пользователи и доступ

- При регистрации создаётся аккаунт со статусом **ожидает подтверждения** (`approved=false`).
- Пока админ не подтвердит аккаунт, пользователь не сможет войти/работать.
- Админ может управлять аккаунтами из клиента: кнопка **Пользователи** (выдать/забрать доступ, удалить аккаунт).

## Структура репозитория

- `server/` — Go API.
- `db/` — SQL инициализация (миграции/seed).
- `client/` — Qt desktop.
